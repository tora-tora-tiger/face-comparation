# 顔認証システム - プロジェクト概要

## プロジェクト名
**class-human-interface** - 特徴点ベース顔認証システム

## 目的と概要

### プロジェクトの目的
3枚の顔画像（基準画像1枚、比較画像2枚）を用いて、特徴点による顔認証アルゴリズムを実装し、どちらの画像が基準画像により近いかを数学的に判定するWebアプリケーションです。

### 課題背景
- **学術課題**: スケーリングパラメータλを考慮した顔照合アルゴリズムの実装
- **技術的挑戦**: 画像の縮小・拡大を考慮したマッチング手法の構築
- **実用性**: 手動・自動の特徴点抽出機能による使いやすさの実現

## アルゴリズムの核心

### 距離計算式
基準画像の特徴点座標を `xi`、比較画像の特徴点座標を `yi` とした時：

```
D(λ) = Σ(xi - λ×yi)²
```

### λパラメータ最適化
- **範囲**: 0.1 ～ 3.0
- **最適化手法**: 黄金分割法（scipy.optimize.minimize_scalar）
- **目的**: 最小距離Dを与えるλ値を求める
- **意味**: λは画像スケールの比率を表し、画像の拡大・縮小を考慮したマッチングを実現

## 主要機能

### 1. 画像管理機能
- **アップロード**: 3枚の画像（基準1枚、比較2枚）
- **対応形式**: JPEG, PNG, GIF, BMP
- **サイズ制限**: 最大5MB/枚
- **プレビュー**: Canvas APIによる即座な表示

### 2. 顔検出・正面化機能
- **自動検出**: OpenCVによる顔領域検出
- **トリミング**: 顔領域の自動切り出し（マージン付き）
- **正面化**: 目の角度を基準とした回転補正
- **品質向上**: 特徴点抽出の精度向上を支援

### 3. 特徴点マーキング機能

#### 手動モード
- **対話的配置**: マウスクリックによる特徴点配置
- **5種類の特徴点**: 右目、左目、鼻、口、その他
- **編集機能**: ドラッグによる移動、右クリックによる削除
- **リアルタイム描画**: Canvas上での即座な反映

#### 自動モード
- **MediaPipe統合**: 468点ランドマーク検出
- **柔軟な抽出**: 部位別の点数調整（1-36点）
- **品質制御**: 信頼度しきい値による品質管理
- **統合管理**: 手動・自動特徴点の組み合わせ利用

### 4. 比較・判定機能
- **λ最適化**: 各比較画像に対する最適λ値計算
- **距離計算**: 高精度な類似度数値化
- **結果表示**: 詳細な比較結果と計算過程の可視化
- **高速処理**: 通常1秒以内での計算完了

## 技術的特徴

### アーキテクチャ
- **フロントエンド**: HTML/CSS/JavaScript（モジュール化設計）
- **バックエンド**: FastAPI + Python
- **画像処理**: OpenCV + MediaPipe + Pillow
- **数値計算**: NumPy + SciPy

### 設計思想
- **分離**: フロントエンドは表示と操作、バックエンドは計算処理
- **モジュール性**: 機能ごとの独立したモジュール設計
- **拡張性**: 新機能追加が容易な構造
- **使いやすさ**: 直感的なUI/UX設計

## プロジェクト構成

### ディレクトリ構造
```
class-human-interface/
├── backend/              # FastAPIバックエンド
│   ├── app/
│   │   ├── main.py       # アプリケーション本体
│   │   ├── models.py     # データモデル定義
│   │   ├── routers/      # APIエンドポイント
│   │   └── services/     # ビジネスロジック
│   └── requirements.txt  # Python依存関係
├── frontend/             # HTML/CSS/JSフロントエンド
│   ├── index.html        # メインUI
│   ├── style.css         # スタイルシート
│   └── js/              # JavaScript（モジュール分割）
├── docs/                # プロジェクトドキュメント
├── log/                 # 開発・修正ログ
├── requirements/        # 仕様書・要件定義
└── uploads/            # アップロード画像保存
```

### 主要ファイル数
- **Python**: 12ファイル（約1,500行）
- **JavaScript**: 9ファイル（約800行）
- **ドキュメント**: 20+ファイル

## 利用フロー

### 基本的な使用手順
1. **画像準備**: 3枚の顔画像を用意（同一人物2枚、別人1枚）
2. **アップロード**: ドラッグ&ドロップまたはファイル選択
3. **顔検出**: 自動的な顔領域検出と正面化処理
4. **特徴点設定**: 手動クリックまたは自動抽出
5. **比較実行**: λ最適化による類似度計算
6. **結果確認**: どちらが基準画像により近いかを確認

### 高度な利用方法
- **パラメータ調整**: 自動抽出の部位別点数設定
- **精度調整**: 信頼度しきい値による品質制御
- **混合利用**: 自動抽出と手動調整の組み合わせ

## 実用性と成果

### 学術的価値
- **数学的厳密性**: λパラメータ最適化の正確な実装
- **アルゴリズム実証**: 理論的手法の実用的検証
- **拡張可能性**: 他の特徴抽出手法への応用

### 技術的成果
- **高精度**: MediaPipeによる精密な特徴点抽出
- **高速処理**: 1ms以下の最適化計算
- **使いやすさ**: 直感的な操作インターフェース

### 実装品質
- **モジュール設計**: 保守しやすいコード構造
- **エラーハンドリング**: 堅牢なエラー処理
- **文書化**: 包括的なドキュメント作成

## 将来の拡張可能性

### 機能拡張
- **データベース統合**: 永続的なデータ保存
- **バッチ処理**: 複数画像の一括処理
- **3D特徴点**: 奥行き情報を含む特徴点抽出
- **機械学習統合**: より高精度な類似度計算

### 技術改善
- **TypeScript化**: 型安全性の向上
- **React/Vue.js**: モダンなSPA化
- **WebAssembly**: 高速画像処理
- **Docker化**: 簡単なデプロイメント

### 応用分野
- **セキュリティ**: 入退室管理システム
- **医療**: 患者識別システム
- **教育**: 顔認証技術の学習ツール
- **研究**: 特徴点抽出手法の比較研究

## まとめ

このプロジェクトは、数学的な顔認証アルゴリズムとモダンなWeb技術を組み合わせた実践的な学習・研究ツールです。λパラメータによるスケール不変な顔照合手法の実装により、理論と実践の両面で価値のあるシステムとなっています。

特に、MediaPipeによる自動特徴点抽出機能の追加により、従来の手動作業を大幅に効率化し、より実用的なツールとして活用できるようになりました。